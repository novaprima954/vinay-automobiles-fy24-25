<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accessory Management - Vinay Automobiles</title>
  <link rel="stylesheet" href="css/common.css">
  <style>
    /* ==========================================
       ACCESSORIES PAGE SPECIFIC STYLES
       ========================================== */
    .dashboard-section {
      background: #f8f9fa;
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 25px;
      border: 2px solid #e9ecef;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .month-selector {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .month-selector label {
      font-weight: 600;
      color: #333;
      font-size: 15px;
    }

    .month-selector select {
      padding: 8px 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 14px;
      min-width: 180px;
      cursor: pointer;
      background: white;
    }

    .dashboard-cards {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 15px;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      cursor: pointer;
      transition: all 0.3s;
      border: 3px solid transparent;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }

    .stat-card.active {
      border-color: #667eea;
      box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
    }

    .stat-card.complete-card {
      border-left: 5px solid #28a745;
    }

    .stat-card.accounts-verified-card {
      border-left: 5px solid #ff9800;
    }

    .stat-card.not-started-card {
      border-left: 5px solid #ffc107;
    }

    .stat-card.partial-card {
      border-left: 5px solid #17a2b8;
    }

    .card-icon {
      font-size: 32px;
      margin-bottom: 10px;
    }

    .card-label {
      font-size: 12px;
      color: #666;
      font-weight: 600;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .card-count {
      font-size: 36px;
      font-weight: 700;
      color: #333;
    }

    .dashboard-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 15px;
      border-top: 2px solid #dee2e6;
    }

    .total-records {
      font-size: 16px;
      color: #333;
      font-weight: 600;
    }

    .btn-export {
      background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s;
      display: none;
    }

    .btn-export:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
    }

    .view-only-banner {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: 600;
      font-size: 16px;
      display: none;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    .account-warning {
      background: #fff3cd;
      border: 3px solid #ffc107;
      color: #856404;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
      font-weight: 600;
      text-align: center;
      font-size: 16px;
      display: none;
      animation: pulse 2s infinite;
    }

    .view-only-section {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 15px;
      border-left: 4px solid #1a73e8;
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .detail-item {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .detail-label {
      font-weight: 600;
      width: 150px;
      color: #555;
      flex-shrink: 0;
    }

    .detail-value {
      color: #333;
      flex: 1;
    }

    .pending-checklist {
      background: white;
      padding: 15px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-top: 10px;
    }

    .pending-item {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      padding: 12px;
      margin: 8px 0;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #ddd;
    }

    .pending-item.status-pending {
      border-left-color: #ffc107;
      background: #fff3e0;
    }

    .pending-item.status-refused {
      border-left-color: #dc3545;
      background: #ffebee;
    }

    .pending-item-name {
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }

    .pending-item-options {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .pending-item-options label {
      display: flex;
      align-items: center;
      gap: 5px;
      margin: 0;
      font-size: 13px;
      font-weight: normal;
      cursor: pointer;
    }

    .pending-item-options input[type="radio"] {
      cursor: pointer;
      width: 16px;
      height: 16px;
    }

    .pending-checklist label {
      display: flex;
      align-items: center;
      margin: 10px 0;
      font-weight: normal;
      cursor: pointer;
      font-size: 14px;
    }

    .pending-checklist input[type="checkbox"] {
      margin-right: 10px;
      width: 18px;
      height: 18px;
      cursor: pointer;
    }

    .pending-checklist input[type="checkbox"]:disabled {
      cursor: not-allowed;
    }

    .limited-edit-note {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 12px;
      margin: 15px 0;
      border-radius: 4px;
      font-size: 14px;
      color: #856404;
    }

    @media (max-width: 768px) {
      .dashboard-cards {
        grid-template-columns: repeat(2, 1fr);
      }

      .card-count {
        font-size: 24px;
      }

      .card-label {
        font-size: 10px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-cards {
        grid-template-columns: 1fr;
      }

      .detail-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <div class="header-title">
        <span style="font-size: 30px;">üîß</span>
        <h1>Accessory Management</h1>
      </div>
      <div class="header-right">
        <span id="currentUser"></span>
        <button class="btn-secondary" onclick="goBack()">‚Üê Back</button>
      </div>
    </div>

    <div class="content">
      <div id="statusMessage" class="message hidden"></div>

      <!-- View-Only Banner -->
      <div class="view-only-banner" id="viewOnlyBanner">
        üîí VIEW-ONLY MODE: Accessory Fitted is marked as "Yes" - Limited editing available
      </div>

      <!-- Dashboard Section -->
      <div class="dashboard-section">
        <div class="dashboard-header">
          <h3 style="margin: 0; color: #333;">üìä Accessory Dashboard</h3>
          <div class="month-selector">
            <label>üìÖ Month:</label>
            <select id="monthSelector">
              <!-- Populated by JS -->
            </select>
          </div>
        </div>

        <div class="dashboard-cards">
          <div class="stat-card complete-card" onclick="filterByStatus('yes')">
            <div class="card-icon">‚úÖ</div>
            <div class="card-label">Complete</div>
            <div class="card-count" id="yesCount">0</div>
          </div>

          <div class="stat-card accounts-verified-card" onclick="filterByStatus('accountsyes_accessoryblank')">
            <div class="card-icon">üîî</div>
            <div class="card-label">Acc Yes, Acc Blank</div>
            <div class="card-count" id="accountsYesAccessoryBlankCount">0</div>
          </div>

          <div class="stat-card not-started-card" onclick="filterByStatus('blank')">
            <div class="card-icon">‚ö†Ô∏è</div>
            <div class="card-label">Not Started</div>
            <div class="card-count" id="blankCount">0</div>
          </div>

          <div class="stat-card partial-card" onclick="filterByStatus('partial')">
            <div class="card-icon">üîÑ</div>
            <div class="card-label">Partially Complete</div>
            <div class="card-count" id="partialCount">0</div>
          </div>
        </div>

        <div class="dashboard-footer">
          <div class="total-records">
            Total Records: <strong id="totalCount">0</strong>
          </div>
          <button class="btn-export" id="exportBtn" onclick="exportToExcel()">
            üì• Export to Excel
          </button>
        </div>
      </div>

      <!-- Manual Search Section -->
      <div class="search-section">
        <h3>üîç Manual Search</h3>
        <div class="search-grid">
          <div class="form-group">
            <label>Search By:</label>
            <select id="searchBy">
              <option value="">-- Select --</option>
              <option>Customer Name</option>
              <option>Mobile No</option>
              <option>Delivery Date</option>
            </select>
          </div>

          <div class="form-group" id="searchValueSection">
            <label>Search For:</label>
            <input type="text" id="searchValue" placeholder="Enter search term...">
          </div>

          <div class="form-group" id="dateFilterSection" style="display: none;">
            <label>Date Filter:</label>
            <select id="dateFilter">
              <option value="">-- Select --</option>
              <option value="today">Today</option>
              <option value="next7">Next 7 Days</option>
              <option value="thismonth">This Month</option>
              <option value="single">Custom Single Date</option>
              <option value="range">Custom Date Range</option>
            </select>
          </div>

          <div class="form-group" id="singleDateSection" style="display: none;">
            <label>Select Date:</label>
            <input type="date" id="singleDate">
          </div>

          <div class="form-group" id="dateRangeFromSection" style="display: none;">
            <label>From Date:</label>
            <input type="date" id="fromDate">
          </div>

          <div class="form-group" id="dateRangeToSection" style="display: none;">
            <label>To Date:</label>
            <input type="date" id="toDate">
          </div>
        </div>

        <div style="margin-top: 15px;">
          <button class="btn-primary" onclick="searchRecords()">üîç Search</button>
        </div>
      </div>

      <!-- Results Section -->
      <div id="resultsSection" class="results-section" style="display: none;">
        <h3 id="resultsTitle">Search Results</h3>
        <div class="table-container">
          <table class="data-table">
            <thead>
              <tr>
                <th>Receipt No</th>
                <th>Customer Name</th>
                <th>Mobile No</th>
                <th>Variant</th>
                <th>Delivery Date</th>
                <th>Accessory Status</th>
              </tr>
            </thead>
            <tbody id="resultsBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Details Section -->
      <div id="detailsSection" class="details-section" style="display: none;">
        <h3>Record Details</h3>
        <input type="hidden" id="selectedRow">
        <input type="hidden" id="currentModel">
        <input type="hidden" id="accountCheckValue">
        <input type="hidden" id="accessoryFittedValue">

        <!-- View-Only Info -->
        <div class="section-header">üìù Sales & Account Info (View Only)</div>
        <div class="view-only-section">
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Receipt No:</span>
              <span class="detail-value" id="detailReceiptNo"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Executive Name:</span>
              <span class="detail-value" id="detailExecName"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Booking Date:</span>
              <span class="detail-value" id="detailDate"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Customer Name:</span>
              <span class="detail-value" id="detailCustomerName"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Mobile No:</span>
              <span class="detail-value" id="detailMobileNo"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Model:</span>
              <span class="detail-value" id="detailModel"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Variant:</span>
              <span class="detail-value" id="detailVariant"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Colour:</span>
              <span class="detail-value" id="detailColour"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Delivery Date:</span>
              <span class="detail-value" id="detailDeliveryDate"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Sales Remark:</span>
              <span class="detail-value" id="detailSalesRemark"></span>
            </div>
          </div>
        </div>

        <h4 style="margin: 15px 0 10px 0; color: #1565c0;">Accessories Ordered:</h4>
        <div class="view-only-section">
          <div id="accessoriesOrdered" class="detail-grid"></div>
        </div>

        <h4 style="margin: 15px 0 10px 0; color: #1565c0;">Account Information:</h4>
        <div class="view-only-section">
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Accountant Name:</span>
              <span class="detail-value" id="detailAccountantName"></span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Account Check:</span>
              <span class="detail-value" id="detailAccountCheck"></span>
            </div>
            <div class="detail-item" style="grid-column: 1 / -1;">
              <span class="detail-label">Account Remark:</span>
              <span class="detail-value" id="detailAccountRemark"></span>
            </div>
          </div>
        </div>

        <!-- Account Warning -->
        <div id="accountWarning" class="account-warning">
          üö´ BLOCKED: Account Check must be "Yes" to update accessory information!
        </div>

        <!-- Limited Edit Note -->
        <div id="limitedEditNote" class="limited-edit-note" style="display: none;">
          ‚ÑπÔ∏è Limited Edit Mode: Accessory Fitted is "Yes". You can only edit Receipt 1, Extra, and clear Pending items.
        </div>

        <!-- Editable Section -->
        <div class="section-header">üîß Accessory Information (Edit)</div>
        <div style="background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%); padding: 18px; border-radius: 12px; margin: 15px 0; border-left: 5px solid #2196f3; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
          <div style="display: flex; align-items: start; gap: 12px;">
            <div style="font-size: 24px;">‚ÑπÔ∏è</div>
            <div>
              <div style="font-weight: 600; font-size: 15px; color: #1565c0; margin-bottom: 8px;">Status Auto-Calculated</div>
              <div style="font-size: 13px; line-height: 1.6; color: #37474f;">
                ‚Ä¢ <strong>Complete:</strong> When ANY item is marked "Refused" OR all items are "None"<br>
                ‚Ä¢ <strong>Partially Complete:</strong> When ANY item is marked "Pending"
              </div>
            </div>
          </div>
        </div>
        <div class="search-grid" style="margin-top: 15px;">
          <div class="form-group">
            <label class="required">Accessory Checker Name:</label>
            <input type="text" id="accessoryCheckerName" readonly style="background: #e9ecef;">
          </div>

          <div class="form-group">
            <label>Accessory Receipt 1:</label>
            <input type="text" id="accessoryReceipt1" placeholder="Numbers only">
          </div>

          <div class="form-group">
            <label>Accessory Extra:</label>
            <input type="text" id="accessoryExtra" placeholder="Any text">
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label>Remark:</label>
            <textarea id="accessoryRemark" rows="5" style="min-height: 120px; resize: vertical;"></textarea>
          </div>

          <div class="form-group" style="grid-column: 1 / -1;">
            <label style="display: block; margin-bottom: 10px; font-size: 15px;">Pending Items:</label>
            <div class="pending-checklist" id="pendingCheckboxes"></div>
          </div>
        </div>

        <div class="button-group">
          <button class="btn-primary" id="updateBtn" onclick="updateRecord()">üíæ Update</button>
          <button class="btn-secondary" onclick="closeDetails()">‚úñ Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/api.js"></script>
  <script src="js/accessories.js"></script>
</body>
</html>
